Currently building has only been tested on linux hosts.

Mappel has been tested with modern G\+C\+C-\/7.\+2.\+0 as well as earlier G\+CC\textquotesingle{}s to 4.\+9.\+4 (which is still required for Matlab integration). In order to maintain compatibility with gcc-\/4.\+9.\+4 and still use modern C++14 features we use the {\ttfamily -\/std=c++1y} G\+CC standard when compiling.

\subsubsection*{Dependencies}

Several standard numerical packages are required to build Mappel. Most distributions should have development versions of these packages which provide the include files and other necessary development files for the packages.


\begin{DoxyItemize}
\item \href{http://arma.sourceforge.net/}{\tt Armadillo}
\item \href{http://www.boost.org/}{\tt Boost}
\item \href{https://github.com/rabauke/trng4}{\tt T\+R\+NG}
\item B\+L\+AS
\begin{DoxyItemize}
\item Requires support for 64-\/bit integers.
\item \href{http://www.netlib.org/blas/}{\tt Netlib B\+L\+AS Reference}
\end{DoxyItemize}
\item L\+A\+P\+A\+CK
\begin{DoxyItemize}
\item Requires support for 64-\/bit integers.
\item \href{http://www.netlib.org/lapack/}{\tt Netlib L\+A\+P\+A\+CK Reference}
\end{DoxyItemize}
\end{DoxyItemize}

\paragraph*{Gentoo}

Add to your {\ttfamily package.\+keywords}


\begin{DoxyCode}
1 sci-libs/lapack-reference int64
2 sci-libs/blas-reference int64
\end{DoxyCode}



\begin{DoxyCode}
1 emerge -av armadillo boost lapack-reference blas-reference
\end{DoxyCode}


For T\+R\+NG there is not a gentoo ebuild in the tree, we provide one at the \href{https://github.com/markjolah/OlahScienceGentooOverlay}{\tt Olah\+Gentoo\+Science\+Overlay}.


\begin{DoxyCode}
1 layman -o  https://github.com/markjolah/OlahScienceGentooOverlay/blob/master/layman.xml -f -a olah-science
2 emerge -av trng
\end{DoxyCode}


\paragraph*{External Projects}

Mappel also depends on several small Github projects which for now are maintained in separate repositories.


\begin{DoxyItemize}
\item \href{https://github.com/markjolah/BacktraceException}{\tt Backtrace\+Exception} -\/ A library to provide debugging output on exception calls. Important for Matlab debugging.
\item \href{https://github.com/markjolah/ParallelRngManager}{\tt Parallel\+Rng\+Manager} -\/ A simple manager for easily deploying a set of R\+NG parallelized over a set number of threads, using the T\+R\+NG parallel R\+NG library.
\item \href{https://github.com/markjolah/ParallelRngManager}{\tt Prior\+Hessian} -\/ The Prior\+Hessian library allows fast computation of log-\/likelihood and derivatives for composite priors.
\end{DoxyItemize}

If these libraries do not exist on the build system or at {\ttfamily C\+M\+A\+K\+E\+\_\+\+I\+N\+S\+T\+A\+L\+L\+\_\+\+P\+R\+E\+F\+IX}, they are automatically downloaded, configured and installed as external dependencies during the C\+Make configure phase.

Normally the Github current versions of the external dependencies are used. To use the H\+E\+AD revision of a local git repository, the following Environment variables can be set\+:


\begin{DoxyItemize}
\item {\ttfamily Backtrace\+Exception\+U\+RL} -\/ Local directory or git U\+RL for the Backtrace\+Exception library \mbox{[}optional\mbox{]} Default to use the H\+E\+AD version from Github
\item {\ttfamily Parallel\+Rng\+Manager\+U\+RL} -\/ Local directory or git U\+RL for the Parallel\+Rng\+Manager library
\item {\ttfamily Prior\+Hessian\+U\+RL} -\/ Local directory or git U\+RL for the Prior\+Hessian library
\end{DoxyItemize}

\subsubsection*{Build process}

\paragraph*{Linux}


\begin{DoxyCode}
1 git clone https://github.com/markjolah/Mappel.git
2 cd Mappel
3 ./build.sh
\end{DoxyCode}
 On successful build the Mappel libraries, binaries, includes, and C\+Make modules are all installed to the {\ttfamily \+\_\+install} dir.

\subsubsection*{Debugging}

C\+Make variable {\ttfamily C\+M\+A\+K\+E\+\_\+\+B\+U\+I\+L\+D\+\_\+\+T\+Y\+PE=Debug} will configure the debug build and all libraries and executables will have a {\ttfamily .debug} suffix.

A convenience script exists to only build the debug versions of the libraries in the local {\ttfamily \+\_\+build} and {\ttfamily \+\_\+install} directories


\begin{DoxyCode}
1 ./build.debug.sh
\end{DoxyCode}
 Tips\+:
\begin{DoxyItemize}
\item Try running {\ttfamily V\+E\+R\+B\+O\+SE=1 make} inside the {\ttfamily \+\_\+build/\+Debug} directory to debug the build/link command lines generated by C\+M\+A\+KE.
\end{DoxyItemize}

\subsubsection*{Python support}

Matlab support is enabled by setting the C\+Make option {\ttfamily -\/\+D\+O\+P\+T\+\_\+\+P\+Y\+T\+H\+ON=1}. At the moment only python 3 is supported.

Several C\+Make variable can control for which python version modules are built.
\begin{DoxyItemize}
\item {\ttfamily M\+A\+P\+P\+E\+L\+\_\+\+P\+Y\+T\+H\+O\+N\+\_\+\+V\+E\+R\+S\+I\+O\+NS} -\/ List of python X.\+Y versions seperated by \char`\"{};\char`\"{} to build modules for (e.\+g., \char`\"{}3.\+4;3.\+5;3.\+6\char`\"{})
\item {\ttfamily M\+A\+P\+P\+E\+L\+\_\+\+P\+Y\+T\+H\+O\+N\+\_\+\+E\+X\+E\+C\+U\+T\+A\+B\+LE} -\/ Name or full path to python executable on the system for which to build (e.\+g., python3).
\end{DoxyItemize}

Mappel uses \href{https://pybind11.readthedocs.io/en/stable/}{\tt pybind11} to compile modules for each Mappel Model class.

\paragraph*{Python development workflow}

The Mappel python package environment is created in the build tree at {\ttfamily build\+\_\+dir/python}, as part of the C\+Make build process. There is a standard \href{https://setuptools.readthedocs.io/en/latest/setuptools.html#}{\tt setuptools} {\ttfamily setup.\+py} that can be used to build binary distributions and also to install to the local system.

The C\+Make install process will automatically install the python .egg using {\ttfamily setup.\+py} under the {\ttfamily C\+M\+A\+K\+E\+\_\+\+I\+N\+S\+T\+A\+L\+L\+\_\+\+P\+R\+E\+F\+IX} directory.

In order to be able to develop the code at the root {\ttfamily mappel/python/} git repository while running and testing the mappel package without having to {\ttfamily make install} on every small change to python code, we use the \href{https://setuptools.readthedocs.io/en/latest/setuptools.html#development-mode}{\tt developer mode} install option provided by setuptoools. In fact, we have made it even easier to use, by making an alias {\ttfamily localdevelop}


\begin{DoxyCode}
1 $ cd \_build/Debug/python
2 $ python setup.py localdevelop
3 $ python -m mappel
\end{DoxyCode}


\subsubsection*{Matlab support}

Matlab support is enabled by setting the C\+Make option {\ttfamily M\+A\+T\+L\+AB=on}. This brings in an additional external dependency,
\begin{DoxyItemize}
\item \href{https://github.com/markjolah/MexIFace}{\tt Mex\+I\+Face} -\/ A cross-\/platform Matlab/\+C++ class-\/based interface wrapper for generating .mex files.
\end{DoxyItemize}

The following environment variables control the Matlab build process
\begin{DoxyItemize}
\item {\ttfamily Mex\+I\+Face\+U\+RL}\+: Local directory or git U\+RL for the Mex\+Iface library (Matlab Support). \mbox{[}optional\mbox{]} Default to use the {\ttfamily H\+E\+AD} version from Github
\item {\ttfamily M\+A\+T\+L\+A\+B\+\_\+\+L\+I\+B\+S\+\_\+\+R\+O\+OT}\+: \mbox{[}Optional\mbox{]} Local path to find Matlab core shared libraries to link against (overrides default search paths). Must contain subdirectory structure {\ttfamily (\$\+M\+A\+T\+L\+A\+B\+\_\+\+A\+R\+CH)//\{bin,extern\}}. {\ttfamily M\+A\+T\+L\+A\+B\+\_\+\+A\+R\+CH} is \mbox{[}glnxa64, maci64, win64\mbox{]}.
\item {\ttfamily M\+A\+T\+L\+A\+B\+\_\+\+R\+O\+O\+T\+\_\+\+G\+L\+N\+X\+A64}\+: Necessary for Matlab. Location of the Matlab {\ttfamily glnxa64} version to link against.
\end{DoxyItemize}

\subsubsection*{Cross-\/building to Win64}

The following Environment variables control the Win64 cross-\/build environment necessary to compile win64 binaries
\begin{DoxyItemize}
\item {\ttfamily M\+X\+E\+\_\+\+R\+O\+OT} Local directory root of the M\+XE Win64 cross environment. Necessary For Win64 cross-\/compiling only.
\item {\ttfamily M\+A\+T\+L\+A\+B\+\_\+\+R\+O\+O\+T\+\_\+\+W\+I\+N64} Necessary for Matlab on Win64 cross build. Location of the Matlab {\ttfamily win64} version to link against.
\end{DoxyItemize}

\subsubsection*{Cross-\/building to O\+SX}


\begin{DoxyItemize}
\item {\ttfamily O\+S\+X\+C\+R\+O\+S\+S\+\_\+\+R\+O\+OT}\+: Local directory root of the O\+S\+X\+Cross O\+SX 64-\/bit cross environment. Necessary for O\+SX cross-\/compiling only.
\item {\ttfamily M\+A\+T\+L\+A\+B\+\_\+\+R\+O\+O\+T\+\_\+\+M\+A\+C\+I64}\+: Necessary for Matlab on O\+SX cross build. Location of the Matlab {\ttfamily maci64} version to link against. 
\end{DoxyItemize}