Mappel is an object-\/oriented image processing library for high-\/performance \href{https://en.wikipedia.org/wiki/Super-resolution_microscopy#Localization_microscopy}{\tt super-\/resolution localization} of Gaussian point emitters in \href{https://en.wikipedia.org/wiki/Fluorescence_microscope#Sub-diffraction_techniques}{\tt fluorescence microscopy} applications.
\begin{DoxyItemize}
\item Mappel uses C\+Make and builds cross-\/platform for Linux and Windows 64-\/bit.
\item Mappel provides object-\/oriented interfaces for C++, Python, and Matlab.
\item Mappel uses Open\+MP to parallelize operations over vectors of images or parameters
\item Mappel is free-\/as-\/in-\/beer and free-\/as-\/in-\/speech! (\mbox{[}G\+P\+L-\/v3\mbox{]}(L\+I\+C\+E\+N\+SE))
\end{DoxyItemize}

\subsubsection*{Documentation}

The Mappel Doxygen documentation can be build with the {\ttfamily O\+P\+T\+\_\+\+D\+OC} C\+Make option and is also available on online\+:
\begin{DoxyItemize}
\item \href{https://markjolah.github.io/Mappel/index.html}{\tt Mappel H\+T\+ML Manual}
\item \href{https://markjolah.github.io/Mappel/pdf/Mappel-0.0.3-reference.pdf}{\tt Mappel P\+DF Manual}
\item \href{https://github.com/markjolah/Mappel}{\tt Mappel github repository}
\end{DoxyItemize}

\subsubsection*{Background}

Point emitter localization is a process of precisely estimating the sub-\/pixel location of a single point source emitters (molecules/proteins) at effective resolutions 10-\/50 times smaller than the fundamental diffraction limit for optical microscopes. Operationally, this is the process of going from blurry, noisy, pixelated images to a sub-\/pixel estimate of true emitter position as well as the uncertainty in that estimate. Figure 1 shows the point emitter localization process with realistic physical values for a typical super-\/resolution fluorescence microscope configuration.

\href{https://raw.githubusercontent.com/markjolah/Mappel/master/doc/images/mappel_fitting_resolution.png}{\tt }

{\bfseries Figure 1}\+: Effective fitting resolution in typical applications 

\paragraph*{Applications}


\begin{DoxyItemize}
\item Stochastic super-\/resolution reconstruction with \href{https://en.wikipedia.org/wiki/Photoactivated_localization_microscopy}{\tt P\+A\+LM} and \href{https://en.wikipedia.org/wiki/Super-resolution_microscopy#Direct_stochastical_optical_reconstruction_microscopy_(dSTORM)}{\tt d\+S\+T\+O\+RM} florescence microscopy techniques.
\item \href{https://en.wikipedia.org/wiki/Single-particle_tracking}{\tt Single particle tracking (S\+PT)}
\begin{DoxyItemize}
\item The \href{https://markjolah.github.io/RPT}{\tt {\itshape Robust Particle Tracking} (R\+PT)} library uses Mappel for the localization phase of tracking.
\end{DoxyItemize}
\item \href{https://iopscience.iop.org/article/10.1088/1367-2630/aa5f74}{\tt Nano-\/structure optical measurements} and alignment.
\item Accurate estimation of fluorophore emitter intensity over time.
\end{DoxyItemize}

\paragraph*{Performance}

Emitter localization applications, especially S\+PT and super-\/resolution imaging, can require millions of emitter estimations per dataset. This demand is only increasing with the drive towards larger E\+M\+C\+CD and S\+C\+M\+OS sensors and longer experiments at higher frame-\/rates. Speed becomes even more crucial for these applications when batch processing dozens of large data files.


\begin{DoxyItemize}
\item Mappel runs all image oriented computations in parallel using Open\+MP making full use the system hardware concurrency.
\item Mappel is fast. It can easily localize 10$^\wedge$4 emitters/sec/core on modern consumer hardware
\item Small and medium-\/sized datasets using Mappel can work well on laptops allowing interactive Matlab applications like \href{https://markjolah.github.io/RPT}{\tt R\+PT} to be used from nearly any machine.
\end{DoxyItemize}

\subsubsection*{Installation}

Mappel uses the \href{https://cmake.org/cmake/help/latest/}{\tt C\+Make} build system, and is designed to be cross-\/compiled from linux to other platforms, primarily Win64, although future O\+SX support is planned.

\subsubsection*{Dependencies}

Several standard numerical packages are required to build Mappel. Most distributions should have development versions of these packages which provide the include files and other necessary development files for the packages.


\begin{DoxyItemize}
\item \href{http://arma.sourceforge.net/docs.html}{\tt {\itshape Armadillo}} -\/ A high-\/performance array library for C++.
\item \href{http://www.boost.org/}{\tt Boost}
\item B\+L\+AS
\begin{DoxyItemize}
\item Requires support for 64-\/bit integers.
\item \href{http://www.netlib.org/blas/}{\tt Netlib B\+L\+AS Reference}
\end{DoxyItemize}
\item L\+A\+P\+A\+CK
\begin{DoxyItemize}
\item Requires support for 64-\/bit integers.
\item \href{http://www.netlib.org/lapack/}{\tt Netlib L\+A\+P\+A\+CK Reference}
\end{DoxyItemize}
\end{DoxyItemize}

Note the {\ttfamily O\+P\+T\+\_\+\+B\+L\+A\+S\+\_\+\+I\+N\+T64} C\+Make option controls whether Armadillo uses B\+L\+AS and L\+A\+P\+A\+CK libraries that use 64-\/bit integer indexing. Matlab uses 64-\/bit by default, so linking Mappel to Matlab M\+EX libraries requires this option enabled. Many linux systems only provide 32-\/bit integer versions of B\+L\+AS and Lapack, and the option can be disabled if Matlab support is not a concern and 64-\/bit support is difficult to provide.

\paragraph*{External Projects}

These packages are specialized C\+Make projects. If they are not currently installed on the development machines we use the \href{https://github.com/markjolah/UncommonCMakeModules/blob/master/AddExternalDependency.cmake}{\tt Add\+External\+Dependency.\+cmake} which will automatically download, configure, build and install to the {\ttfamily C\+M\+A\+K\+E\+\_\+\+I\+N\+S\+T\+A\+L\+L\+\_\+\+P\+R\+E\+F\+IX}, enabling their use through the normal C\+Make {\ttfamily find\+\_\+package()} system.


\begin{DoxyItemize}
\item \href{https://markjolah.github.iom/BacktraceException}{\tt Backtrace\+Exception} -\/ A library to provide debugging output on exception calls. Important for Matlab debugging.
\item \href{https://markjolah.github.io/ParallelRngManager}{\tt Parallel\+Rng\+Manager} -\/ A simple manager for easily deploying a set of R\+NG parallelized over a set number of threads, using the T\+R\+NG parallel R\+NG library.
\item \href{https:///markjolah.github.io/ParallelRngManager}{\tt Prior\+Hessian} -\/ The Prior\+Hessian library allows fast computation of log-\/likelihood and derivatives for composite priors.
\end{DoxyItemize}

\subsection*{Model classes}

Mappel provides model objects that correspond to different fitting-\/modes (psf-\/models). Mappel\textquotesingle{}s core is a C++ library {\ttfamily libmappel.\+so} that uses Open\+MP to automatically parallelize localizations over multiple images. Mappel also provides detailed object-\/oriented interfaces for Python and Matlab, using the same concept of a Model class to represent each class of psf fitting models.

\subsubsection*{Computations available}


\begin{DoxyItemize}
\item {\ttfamily llh} -\/ log-\/likelihood (log of pdf)
\item {\ttfamily rllh} -\/ relative log-\/likelihood (log of pdf without constant terms)
\item {\ttfamily grad} -\/ derivative of log-\/likelihood (or equivalently of relative-\/llh)
\item {\ttfamily grad2} -\/ 2nd-\/derivative of log-\/likelihood
\item {\ttfamily hessian} -\/ hessian of log-\/likelihood
\end{DoxyItemize}

\subsection*{Design Notes}

\subsubsection*{Static Polymorphism}

The Mappel library is designed using static polymorphism (templates), and as such avoids virtual functions for small-\/grained tasks, and instead uses templates, which allow many small functions to be inlined. This aggressive inlining by the compiler produces log-\/likelihood, gradient, and hessian functions that are nearly as fast as hand-\/coded functions.

\subsection*{License}

\subsection*{L\+I\+C\+E\+N\+SE}


\begin{DoxyItemize}
\item Copyright\+: 2013-\/2019
\item Author\+: Mark J. Olah
\item Email\+: (\href{mailto:mjo@cs.unm}{\tt mjo@cs.\+unm} D\+OT edu)
\item L\+I\+C\+E\+N\+SE\+: G\+P\+L-\/v3 See \href{https://github.com/markjolah/MexIFace/blob/master/LICENSE}{\tt L\+I\+C\+E\+N\+SE} file. 
\end{DoxyItemize}